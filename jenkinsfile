
pipeline {
	agent any
	// 定义仓库地址
	environment {
	    REPOSITORY=""
	}
	stages {
		stage('Build'){
			steps {
				echo 'Build ...'
				// sh 'mvn package docker:build'
				sh "mvn install -Dmaven.test.skip=true"
			}
		}
		stage('Test') {
			steps {
				echo 'Testing...'
			}
		}
		stage('Deploy') {
			steps {
				echo 'Deploying...'
				sh "pwd"
				println "${WORKSPACE}"
				println "${JENKINS_HOME}"
				sh "rm target/*.jar src/main/docker"
				dir('src/main/docker') {
                    sh "pwd"
                    sh "ls"
                    echo "BUILD_NUMBER ---- ${BUILD_NUMBER}"
                    echo "BUILD_ID ---- ${BUILD_ID}"
                    echo "BUILD_DISPLAY_NAME ---- ${BUILD_DISPLAY_NAME}"
                    echo "JOB_NAME ---- ${JOB_NAME}"
                    echo "BUILD_TAG ---- ${BUILD_TAG}"
                    echo "EXECUTOR_NUMBER ---- ${EXECUTOR_NUMBER}"
                    echo "NODE_NAME ---- ${NODE_NAME}"
                    echo "NODE_LABELS ---- ${NODE_LABELS}"

                    sh "docker build -t demo:${BUILD_NUMBER} ."
                }
				// sh " docker run -p 9999:9999 -it -d --name=demo springboot/demo"
			}
		}
	
	}
}
